<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <!-- Подключаем библиотеку для сканирования QR-кодов -->
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
    <h1>Сканируйте QR-код</h1>
    <!-- Элемент для отображения видеопотока и сканирования -->
    <div id="reader" style="width: 300px;"></div>
    <script>
        // Функция обработки успешного сканирования QR-кода
        function onScanSuccess(decodedText) {
            // Отправляем результат на сервер через GET-запрос
            fetch(`/send_result?data=${encodeURIComponent(decodedText)}`);
            // Выводим уведомление пользователю с результатом
            alert(`QR-код отсканирован: ${decodedText}`);
        }

        // Создаем объект для работы с библиотекой Html5QrCode
        const html5QrCode = new Html5Qrcode("reader");

        // Инициализируем видеопоток и начинаем сканирование
        html5QrCode.start(
            // Указываем, какую камеру использовать. "environment" — задняя камера.
            { facingMode: "environment" }, 
            // Настройки сканирования: частота кадров и размер области сканирования
            { fps: 10, qrbox: 250 },
            // Коллбэк для успешного сканирования
            onScanSuccess
        )
        .catch(err => {
            // Если возникла ошибка, выводим её в консоль и уведомляем пользователя
            console.error("Ошибка запуска камеры:", err);
            alert("Не удалось получить доступ к камере. Проверьте настройки браузера.");
        });

        // Проверяем права на использование камеры перед запуском (дополнительно)
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                console.log("Доступ к камере предоставлен.");
            })
            .catch((err) => {
                console.error("Ошибка доступа к камере:", err);
                alert("Проверьте разрешения на использование камеры.");
            });
    </script>
</body>
</html>